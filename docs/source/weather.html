<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å®æ—¶å¤©æ°”å¡ç‰‡</title>
    <style>
        /* è®©å¤©æ°”å¡ç‰‡å±…åº•éƒ¨ä¸­å¤® */
        .weather-card {
            background: rgba(255, 255, 255, 0.85);
            border-radius: 16px;
            padding: 10px;
            width: 260px;
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            box-shadow: 0px 4px 12px rgba(0, 0, 0, 0.2);
            transition: background 0.3s, color 0.3s;
        }

        /* è®©æ–‡å­—å±…å·¦ */
        .info {
            font-size: 16px;
            font-weight: bold;
            color: #222;
            margin: 8px 5px;
            text-align: left;
        }

        /* é€‚é…å¤œé—´æ¨¡å¼ */
        @media (prefers-color-scheme: dark) {
            .weather-card {
                background: rgba(60, 60, 60, 0.85);
                color: #F3F3F3;
            }
            .info {
                color: #F3F3F3;
            }
        }
    </style>
</head>
<body>

    <!-- å¤©æ°”ä¿¡æ¯å¡ç‰‡ -->
    <div class="weather-card">
        <p id="time" class="info">â° æ—¶é—´åŠ è½½ä¸­...</p>
        <p id="location" class="info">ğŸ“ ä½ç½®åŠ è½½ä¸­...</p>
        <p id="weather" class="info">ğŸŒ¤ å¤©æ°”æ•°æ®åŠ è½½ä¸­...</p>
    </div>

    <script>
        function updateTime() {
            let now = new Date();
            let timeString = now.toLocaleString();
            document.getElementById("time").innerText = `â° æ—¶é—´: ${timeString}`;
        }

        function fetchWeather(lat, lon, apiKey) {
            let weatherUrl = `https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=${apiKey}&units=metric&lang=zh_cn`;

            fetch(weatherUrl)
                .then(response => response.json())
                .then(weatherData => {
                    let temperature = weatherData.main.temp;
                    let weatherCode = weatherData.weather[0].id;

                    // æ¸©åº¦è¡¨æƒ…ç¬¦å·æ˜ å°„
                    let tempEmoji = temperature <= 0 ? "â„" :
                                    temperature <= 15 ? "ğŸ¥¶" :
                                    temperature <= 25 ? "ğŸ˜Š" :
                                    temperature <= 35 ? "ğŸ˜…" : "ğŸ”¥";

                    // å¤©æ°”ä»£ç æ˜ å°„ï¼ˆåŸºäº OpenWeatherMap æä¾›çš„ IDï¼‰
                    let weatherMap = {
                        800: "â˜€ æ™´æœ—", 801: "ğŸŒ¤ å°‘äº‘", 802: "â›… å±€éƒ¨å¤šäº‘",
                        803: "â˜ é˜´å¤©", 804: "â˜ å¤šäº‘",
                        500: "ğŸŒ¦ å°é›¨", 501: "ğŸŒ§ ä¸­é›¨", 502: "â›ˆ å¤§é›¨",
                        511: "â„ å†»é›¨", 600: "â„ å°é›ª", 601: "â„ ä¸­é›ª",
                        602: "â„ æš´é›ª", 701: "ğŸŒ« é›¾éœ¾", 781: "ğŸŒª é¾™å·é£"
                    };

                    let weatherDescription = weatherMap[weatherCode] || "ğŸŒ å¤©æ°”æ•°æ®æœªçŸ¥";

                    document.getElementById("weather").innerText = `${tempEmoji} æ¸©åº¦: ${temperature}Â°C | ${weatherDescription}`;
                })
                .catch(error => {
                    document.getElementById("weather").innerText = `âŒ æ— æ³•è·å–å¤©æ°”ä¿¡æ¯: ${error}`;
                });
        }

        function getLocationAndFetchWeather(apiKey) {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        let lat = position.coords.latitude.toFixed(4);
                        let lon = position.coords.longitude.toFixed(4);

                        // é€†åœ°ç†ç¼–ç ï¼ˆè·å–åŸå¸‚åç§°ï¼‰
                        let geoUrl = `https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}`;

                        fetch(geoUrl)
                            .then(response => response.json())
                            .then(locationData => {
                                let city = locationData.address.city || locationData.address.town || locationData.address.village || "æœªçŸ¥åŸå¸‚";
                                let country = locationData.address.country || "æœªçŸ¥å›½å®¶";

                                document.getElementById("location").innerText = `ğŸ“ ä½ç½®: ${city}, ${country}`;

                                // è·å–å¤©æ°”ä¿¡æ¯
                                fetchWeather(lat, lon, apiKey);
                            })
                            .catch(error => {
                                document.getElementById("location").innerText = "ğŸ“ æ— æ³•è·å–åŸå¸‚ä¿¡æ¯";
                            });
                    },
                    (error) => {
                        document.getElementById("location").innerText = "ğŸ“ æ— æ³•è·å–ä½ç½®ä¿¡æ¯";
                        document.getElementById("weather").innerText = `âŒ ä½ç½®è·å–å¤±è´¥: ${error.message}`;
                    }
                );
            } else {
                document.getElementById("location").innerText = "ğŸ“ ä½ç½®è·å–å¤±è´¥";
                document.getElementById("weather").innerText = "âŒ æ­¤æµè§ˆå™¨ä¸æ”¯æŒåœ°ç†å®šä½";
            }
        }

        setInterval(updateTime, 1000);

        let apiKey = "fc86d110601a62e0d4d77e3d982c0a4c"; // æ›¿æ¢ä¸ºä½ çš„ OpenWeatherMap API Key
        getLocationAndFetchWeather(apiKey);
    </script>

</body>
</html>

