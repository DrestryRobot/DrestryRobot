<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>实时天气卡片</title>
    <style>
        .weather-card {
            background: rgba(255, 255, 255, 0.85);
            border-radius: 16px;
            padding: 10px;
            width: 260px;
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            box-shadow: 0px 4px 12px rgba(0, 0, 0, 0.2);
            transition: background 0.3s, color 0.3s;
        }

        .info {
            font-size: 16px;
            font-weight: bold;
            color: #222;
            margin: 8px 5px;
            text-align: left;
        }

        @media (prefers-color-scheme: dark) {
            .weather-card {
                background: rgba(60, 60, 60, 0.85);
                color: #F3F3F3;
            }
            .info {
                color: #F3F3F3;
            }
        }
    </style>
</head>
<body>

    <div class="weather-card">
        <p id="time" class="info">⏰ 时间加载中...</p>
        <p id="location" class="info">📍 位置加载中...</p>
        <p id="weather" class="info">🌤 天气数据加载中...</p>
    </div>

    <script>
        function updateTime() {
            let now = new Date();
            let timeString = now.toLocaleString();
            document.getElementById("time").innerText = `⏰ 时间: ${timeString}`;
        }

        async function fetchWeather(cityCode) {
            let weatherUrl = `https://devapi.qweather.com/v7/weather/now?location=${cityCode}`;
            try {
                let response = await fetch(weatherUrl);
                let weatherData = await response.json();
                displayWeather(weatherData);
            } catch {
                document.getElementById("weather").innerText = "❌ 无法获取天气信息";
            }
        }

        function displayWeather(weatherData) {
            let temperature = parseFloat(weatherData.now.temp).toFixed(1);
            let weatherDescription = weatherData.now.text;

            let tempEmoji = temperature <= 0 ? "❄" :
                            temperature <= 15 ? "🥶" :
                            temperature <= 25 ? "😊" :
                            temperature <= 35 ? "😅" : "🔥";

            document.getElementById("weather").innerText = `${tempEmoji} 温度: ${temperature}°C | ${weatherDescription}`;
        }

        async function getLocationAndFetchWeather() {
            try {
                let response = await fetch("https://ipinfo.io/json");
                let data = await response.json();
                let city = data.city || "北京";
                let country = data.country || "中国";

                document.getElementById("location").innerText = `📍 位置: ${city}, ${country}`;

                let cityCode = await getCityCode(city);
                fetchWeather(cityCode);
            } catch {
                document.getElementById("location").innerText = "📍 位置: 北京，中国";
                fetchWeather("101010100"); // 北京城市代码
            }
        }

        async function getCityCode(city) {
            let cityMap = {
                "北京": "101010100",
                "上海": "101020100",
                "广州": "101280101",
                "深圳": "101280601",
                "成都": "101270101",
                "西安": "101110101"
            };

            return cityMap[city] || "101010100"; // 默认使用北京
        }

        setInterval(updateTime, 1000);
        getLocationAndFetchWeather();
    </script>

</body>
</html>
